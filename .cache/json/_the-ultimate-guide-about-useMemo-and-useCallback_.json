{"data":{"markdownRemark":{"html":"<p>Mến chào các bạn đã quay trở lại với \"Kỹ sư mặt tiền\".</p>\n<p>Nếu bạn giống như mình, đã từng mày mò tìm hiểu và áp dụng React hooks vào dự án, và rồi cứ mơ mơ hồ hồ về cách sử dụng, giống và khác nhau, khi nào sử dụng cái nào,... giữa <strong>useMemo và useCallback</strong>. Thì hãy cùng mình tìm hiểu bài viết ngày hôm nay nhé.</p>\n<h2>1. Một loạt câu hỏi \"tại sao?\"</h2>\n<blockquote>\n<p>Note: Nếu bạn đã quá quen thuộc với các vấn đề về re-render, tại sao, tác hại, ... thì xin hãy skip qua section này.</p>\n</blockquote>\n<p>Nếu đã đọc post trước của mình về <a href=\"https://kysumattien.com/miskates-make-memo-and-pure-component-useless/\" rel=\"noopener noreferrer\" target=\"_blank\"><strong>Các lỗi sai khiến việc sử dụng React.memo và PureComponent trở nên vô ích</strong></a>, mình đã có đề cập đến việc:</p>\n<p><strong>Khác với Class Component, các Functional Component không có các life cycle như constructor, componentDidmount,... Mọi thứ nằm bên trong \"ruột\" của một Functional component chính là body của hàm render ứng với người anh em Class component.</strong></p>\n<p>Điều này dẫn đến việc, bất kể khi nào functional component đó re-render, các hàm và logic tính toán khai báo bên trong component sẽ được <strong>tính toán lại</strong>.</p>\n<p><span class=\"problem-label\">Vì sao tính toán lại?</span></p>\n<p>Vì đây là cách hoạt động của functional component. Mọi thứ trong thế giới của <strong>Functional component</strong> đều xoay quanh <strong>closures</strong>. (Có thể trong tương lai mình sẽ viết một post về chủ đề này.)</p>\n<p>Nói ngắn gọn thì việc tạo mới các <strong>funtion hay logic tính toán ở mỗi lần re-render là bắt buộc</strong>, bằng cách làm như vậy thì các funtion hay các hàm tính toán đó mới có khả năng access được các <strong>giá trị mới nhất</strong> của các <strong>biến state</strong>.</p>\n<p>Vì ở mỗi lần re-render, functional component kia sẽ tạo ra một closure khác nhau (một vỏ bọc, chứa tất cả hàm, biến của component đó). Nếu một hàm khai báo bên trong component có sử dụng <strong>một biến state bất kỳ</strong> để tính toán, mà bản thân hàm này không được tạo mới ứng với mỗi lần re-render, thì nó sẽ chỉ <strong>refer</strong> tới biến state cũ của lần render trước đó, dẫn đến tính toán sai.</p>\n<p>Nhưng bản thân việc tạo mới các function liên tục bên trong functional component lại nảy sinh vấn đề mới, đó là re-render.</p>\n<p><span class=\"problem-label\">Vì sao re-render?</span></p>\n<p>Vì function cũng là object, ở mỗi lần re-render, hàm được tạo mới, tương đương một object được tạo mới. Trong trường hợp object hay function này được pass xuống component con, thì component con sẽ bị re-render, mặc cho component con đó có áp dụng React.memo hay React.PureComponent. (Cơ chế so sánh nông, bạn đọc lại mục 5 trong <a href=\"https://kysumattien.com/react-purre-component-and-react-memo/\" rel=\"noopener noreferrer\" target=\"_blank\">bài này</a>)</p>\n<p><span class=\"problem-label\">Vì sao nên tránh re-render? Re-render là xấu?</span></p>\n<p>Không. <strong>Re-render không xấu</strong>, nó chỉ là một bước để React <strong>so sánh</strong> và quyết định có nên <strong>update</strong> thứ gì hay không. Quá trình re-render được handle bởi React và nó diễn ra <strong>rất nhanh</strong>, performance đã được đảm bảo tối ưu nhất có thể bởi React. Thường thì với các tác vụ render text, logic nho nhỏ, bạn <strong>không cần</strong> và <strong>không nên</strong> bận tâm đến việc có chạy dư 1, 2 lần re-render. Thậm chí việc áp dụng các kỹ thuật memoization vào các logic nhỏ như vậy càng làm performance <strong>tệ hơn</strong>, vì nó phát sinh thêm các phần việc kiểm tra, so sánh, ...</p>\n<p><strong>Nhưng...</strong></p>\n<p>Khi kết hợp với các logic tính toán lớn như hiển thị bảng dữ liệu với cả trăm dòng dữ liệu, logic sort, filter, hay các tác vụ vẽ biểu đồ, các UI library có animation,... thì bạn bắt buộc phải quan tâm tới việc hạn chế tối đa các lần re-render không cần thiết.</p>\n<p><span class=\"problem-label\">Tại sao phải hạn chế tối đa?</span></p>\n<p>Vì với các UI library có animation, sẽ xảy ra tình trạng animation flicking.</p>\n<p>Với các tác vụ tính toán sort, filter nặng nề, nó sẽ chạy đi chạy lại gây hao tốn performance.</p>\n<h2>2. Vậy useMemo và useCacllback là cái gì?</h2>\n<p>Là hai hook của React, giúp tạo ra các <strong>memoized</strong> function và value, nôm na là khi nào cần tạo mới thì mới tạo mới, không thì dùng lại giá trị cũ, từ đó tránh được các vấn đề về re-render, performance kể trên.</p>\n<p>Trang chủ Reactjs đề cập rằng useCallback:</p>\n<blockquote>\n<p>Trả ra một memoized <strong>function</strong></p>\n</blockquote>\n<p>Còn useMemo thì:</p>\n<blockquote>\n<p>Trả ra một memoized <strong>value</strong></p>\n</blockquote>\n<p><span class=\"inline-code\">useCallback</span> và <span class='inline-code'>useMemo</span> đều nhận vào 2 tham số.</p>\n<p>Tham số thứ nhất là một <strong>function</strong> và tham số thứ hai là <strong>mảng chứa các dependencies</strong>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token keyword\">const</span> returnedFunction <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> deps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> returendValue <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> deps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span></span></pre></div>\n<p><span class=\"solution-label\">useMemo</span></p>\n<p><span class='inline-code'>useMemo</span> tập trung vào việc <strong>tránh lặp đi lặp lại các logic tính toán nặng nề</strong>.</p>\n<p>Cụ thể, nó trả về một <strong>giá trị</strong> (là kết quả trả về từ việc <strong>thực thi</strong>, <strong>chạy</strong> hàm <span class='inline-code'>fn</span> mà bạn pass vào ứng với tham số thứ nhất).</p>\n<p>Nếu một trong số các dependencies thay đổi, thì hàm tính toán sẽ được <strong>thực thi lại</strong>, từ đó trả ra giá trị mới. Ngược lại, nếu nhận thấy giá trị của các dependencies kia không đổi, thì ngay lập tức <span class='inline-code'>useMemo</span> trả ra kết quả trước đó mà không hề tính toán lại, từ đó tránh được một khối lượng lớn công việc, giúp ích cho performance.</p>\n<p>Ngoài ra, lợi dụng tính năng trả ra <strong>giá trị trước đó</strong> khi dependencies không thay đổi, ta cũng sẽ tránh được việc tạo mới các object không cần thiết (object cũ sẽ được trả ra), giúp tránh re-render không cần thiết.</p>\n<p><span class=\"solution-label\">useCallback</span></p>\n<p><span class=\"inline-code\">useCallback</span> thì tập trung giải quyết vấn đề về performance, khi mà các callback function được tạo ở <strong>functional component cha</strong> pass xuống component con luôn bị tạo mới, khiến cho con luôn bị re-render.</p>\n<p><span class=\"inline-code\">useCallback</span> trả về một <strong>function</strong> (chính là function bạn pass vào ứng với tham số thứ nhất), callback function này sẽ được <strong>tạo lại khi một trong số các dependencies thay đổi</strong>. Nếu dependencies không đổi, function trả về sẽ là function trước đó -> tức là function pass xuống component con không bị tạo mới, tương đương không có object được tạo mới -> component con không bị re-render.</p>\n<h2>3. Ví dụ cụ thể với useMemo</h2>\n<p><span class=\"solution-label\">Tránh tính toán nặng</span></p>\n<p><strong>Khi không dùng <span class=\"inline-code\">useMemo</span></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">componentA</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getArray</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// tưởng tượng một hàm phức tạp, filter,</span>\n    <span class=\"token comment\">// sort một mảng 100 phần tử, tốn 2s để chạy</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">filterAndSortAndDoSomething</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">mảng phức tạp: </span><span class=\"token punctuation\">{</span><span class=\"token function\">getArray</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Viết như thế này, mỗi lần bấm nút tăng biến <span class='inline-code'>count</span>, componentA sẽ re-render, và hàm <span class='inline-code'>getArray</span> sẽ bị chạy lại, tốn 2s để có kết quả và render ra màn hình.</p>\n<p><strong>Khi dùng <span class=\"inline-code\">useMemo</span></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">componentA</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> getArray <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// tưởng tượng một hàm phức tạp, filter,</span>\n    <span class=\"token comment\">// sort một mảng 100 phần tử, tốn 2s để chạy</span>\n    <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token function\">filterAndSortAndDoSomething</span><span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> result<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">mảng phức tạp: </span><span class=\"token punctuation\">{</span>getArray<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Giờ đây, mặc cho bạn bấm nút và tăng biến <span class='inline-code'>count</span>, hàm getArray ngay lập tức trả ra giá trị <span class='inline-code'>result</span> trước đó mà không cần tốn 2s tính toán. Để ý <span class=\"inline-code\">getArray</span> lúc này không còn dấu gọi hàm nữa, vì bản thân useMemo đã chạy hàm ta pass vào, việc của dev chúng ta là nhận ra một memoized value mà thôi.</p>\n<p><span class=\"solution-label\">Tránh re-render</span></p>\n<p><strong>Khi không dùng <span class=\"inline-code\">useMemo</span></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ComponentA</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getStyle</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      color<span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">,</span>\n      background<span class=\"token operator\">:</span> <span class=\"token string\">'gold'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      CHA NÈ CON\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ComponentB</span></span> <span class=\"token attr-name\">myStyle</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token function\">getStyle</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> ComponentB <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>myStyle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">CON NÈ CHA</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Viết như thế này, mỗi lần <span class='inline-code'>ComponentA</span> re-render, hàm <span class='inline-code'>getStyle</span> sẽ tạo ra một <strong>object mới</strong> và pass xuống <span class='inline-code'>ComponentB</span>, khiến cho <span class='inline-code'>ComponentB</span> bị re-render (mặc dù đã sử dụng React.memo)</p>\n<p><strong>Khi dùng <span class=\"inline-code\">useMemo</span></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">ComponentA</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> getStyle <span class=\"token operator\">=</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span>\n      color<span class=\"token operator\">:</span> <span class=\"token string\">'blue'</span><span class=\"token punctuation\">,</span>\n      background<span class=\"token operator\">:</span> <span class=\"token string\">'gold'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      CHA NÈ CON\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ComponentB</span></span> <span class=\"token attr-name\">myStyle</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>getStyle<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> ComponentB <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>myStyle<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">CON NÈ CHA</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Giờ đây, khi dùng <span class=\"inline-code\">useMemo</span> cho hàm <span class='inline-code'>getStyle</span>, (để ý getStyle không còn dấu gọi hàm, useMemo đã thực thi hàm mà chúng ta pass vào rồi, ta chỉ nhận ra kết quả - một memoized value mà thôi) ở các lần re-render sau của <span class=\"inline-code\">ComponentA</span>, object style cũ sẽ được trả ra thay vì tạo mới -> React.memo ở <span class=\"inline-code\">ComponentB</span> nhận thấy prop nhận vào không có sự thay đổi -> không re-render.</p>\n<h2>4. Ví dụ cụ thể với useCallback</h2>\n<p><span class=\"solution-label\">Tránh re-render ở component con</span></p>\n<p><strong>Khi không dùng <span class=\"inline-code\">useCallback</span></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Parent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> setA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">onChangeHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token comment\">//Pure là component con có sử dụng React.memo</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pure</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onChangeHandler<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Viết thế này, mỗi lần component <span class=\"inline-code\">Parent</span> re-render, callback <span class=\"inline-code\">onChangeHandler</span> sẽ được tạo mới và pass xuống component con <span class=\"inline-code\">Pure</span>. Mặc cho component có sử dụng React.memo, nó vẫn bị re-rendered.</p>\n<p><strong>Khi dùng <span class=\"inline-code\">useCallback</span></strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">Parent</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> <span class=\"token operator\">...</span> <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">,</span> setA<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> onChangeHandler <span class=\"token operator\">=</span> <span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">doSomething</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>a<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token operator\">...</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">...</span>\n    <span class=\"token comment\">//Pure là component con có sử dụng React.memo</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Pure</span></span> <span class=\"token attr-name\">onChange</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>onChangeHandler<span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Nhờ sử dụng <span class='inline-code'>useCallback</span>, giờ đây ở mỗi lần component <span class='inline-code'>Parent</span> re-render, hàm <span class='inline-code'>onChangeHanlder</span> sẽ không còn luôn luôn bị tạo mới nữa, mà sẽ chỉ được tạo mới khi depencency của nó là biến <span class='inline-code'>a</span> thay đổi. Function không bị tạo mới -> object không bị tạo mới -> component con nhận vào cũng không bị re-render. Tuyệt vời!</p>\n<h2>5. useMemo dùng thay thế useCallback cũng được</h2>\n<p>Như đã nói phía trên, <span class=\"inline-code\">useMemo</span> sẽ thực thi hàm được pass vào và trả ra kết quả. Nếu khéo léo, return ra <strong>function</strong> như là một <strong>kết quả</strong>, thì lúc này useMemo sẽ có vai trò và tác dụng giống hệt useCallback.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-js line-numbers\"><code class=\"language-js\"><span class=\"token function\">useCallback</span><span class=\"token punctuation\">(</span>fn<span class=\"token punctuation\">,</span> deps<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">//tương đương</span>\n<span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> fn<span class=\"token punctuation\">,</span> deps<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span></span></pre></div>\n<h2>6. Kết luận</h2>\n<p>Qua bài viết trên, hy vọng đã giúp các bạn giải mã hai hooks khá khó hiểu trong React là <span class=\"inline-code\">useCallback</span> và <span class='inline-code'>useMemo</span>, đồng thời giúp chúng ta hiểu được các vấn đề về re-render trong thế giới functional component.</p>\n<p>Nếu các bạn thấy hay hãy cho mình một like và một share để khích lệ tinh thần mình nha.</p>\n<p>Ngoài ra, nếu muốn mình làm thêm bài viết về chủ đề nào thì các bạn comment cho mình biết luôn nha.</p>\n<p>Rất mong nhận được ý kiến đóng góp của mọi người.</p>\n<p>Hẹn gặp lại các bạn trong các bài viết sau.</p>\n<h2>7. Nguồn và bài viết hay liên quan</h2>\n<p><a href=\"https://medium.com/@jan.hesters/usecallback-vs-usememo-c23ad1dc60\" target=\"_blank\" rel=\"noopener noreferrer\">useCallback vs useMemo</a> - Jan Hesters - medium.com</p>\n<p><a href=\"https://dev.to/milu_franz/demystifying-react-hooks-usecallback-and-usememo-1a8j\" target=\"_blank\" rel=\"noopener noreferrer\">Demystifying React Hooks: useCallback and useMemo</a> - Milu - dev.com</p>","featuredImg":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAATABQDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQDAQL/xAAXAQADAQAAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAGb3PcETqdItCs8wn//xAAaEAACAwEBAAAAAAAAAAAAAAAAAQIREwMh/9oACAEBAAEFAs/MpZ5sjUyL5xVMTLLP/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAIQE//aAAgBAwEBPwEya//EABcRAAMBAAAAAAAAAAAAAAAAAAABEBL/2gAIAQIBAT8BNK//xAAcEAACAgIDAAAAAAAAAAAAAAAAAQIhERIgMjP/2gAIAQEABj8CqLOrZZcmkY3PXh//xAAcEAEAAgMBAQEAAAAAAAAAAAABABEhUWExkaH/2gAIAQEAAT8hBcY7CUWc3HJxDG+JfsAB125k8fI24rcVfs//2gAMAwEAAgADAAAAEHQIAv/EABgRAQADAQAAAAAAAAAAAAAAAAEAEBFh/9oACAEDAQE/EAVwnGtn/8QAFhEAAwAAAAAAAAAAAAAAAAAAABBh/9oACAECAQE/EC7/AP/EAB0QAQADAAIDAQAAAAAAAAAAAAEAESExQWFxgdH/2gAIAQEAAT8Qe2Vck+suUiirorEHqF6I/IPiZ4CuUF6JkwtpS/yKrUvFNwHaUeU7JP/Z","aspectRatio":1.0459183673469388,"src":"/static/ac8347d22b9abaa8d7b88c7b292b5e54/8f023/K5sxPWF.jpg","srcSet":"/static/ac8347d22b9abaa8d7b88c7b292b5e54/547bc/K5sxPWF.jpg 205w,\n/static/ac8347d22b9abaa8d7b88c7b292b5e54/fb51d/K5sxPWF.jpg 410w,\n/static/ac8347d22b9abaa8d7b88c7b292b5e54/8f023/K5sxPWF.jpg 820w,\n/static/ac8347d22b9abaa8d7b88c7b292b5e54/1d3b0/K5sxPWF.jpg 1095w","sizes":"(max-width: 820px) 100vw, 820px"}}},"frontmatter":{"title":"Tất tần tật về useMemo và useCallback","featuredImgAlt":"Tất tần tật về useMemo và useCallback","featuredImgUrl":"https://i.imgur.com/K5sxPWF.jpg?1","description":"Đã tìm hiểu và thử dùng useMemo và useCallback nhưng vẫn còn khó hiểu? Bài viết này sẽ giúp bạn","author":{"name":"Thiên Bùi"},"date":"2020-09-05"}}},"pageContext":{"slug":"/the-ultimate-guide-about-useMemo-and-useCallback/","previous":{"fields":{"slug":"/react-context-makes-it-easily-rerender-and-how-to-avoid/"},"frontmatter":{"title":"3 cách để tránh re-render khi dùng React context"}},"next":{"fields":{"slug":"/what-and-why-http2-part-2/"},"frontmatter":{"title":"HTTP/2 thay đổi cuộc chơi, cách bundle assets, source code như thế nào?"}}}}