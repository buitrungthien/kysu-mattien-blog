{"expireTime":9007200862049993000,"key":"transformer-remark-markdown-html-d3e9534f02c08dc18e4f77713dd700d9-gatsby-remark-prismjsgatsby-remark-stackblitz@weknow/gatsby-remark-codepen-","val":"<p>Náº¿u Ä‘Ã£ tá»«ng sá»­ dá»¥ng React context cho dá»± Ã¡n cá»§a báº¡n, vÃ  gáº·p pháº£i tÃ¬nh tráº¡ng cÃ¡c component con - <strong>Consumer</strong> re-render ráº¥t nhiá»u láº§n, tháº­m chÃ­ bá»‹ sai logic khi dÃ¹ng vá»›i cÃ¡c thÆ° viá»‡n UI cÃ³ animation, vÃ  Ä‘au Ä‘áº§u khÃ´ng biáº¿t lÃ½ do táº¡i sao, lÃ m cÃ¡ch nÃ o Ä‘á»ƒ kháº¯c phá»¥c viá»‡c nÃ y, thÃ¬ hÃ£y cÃ¹ng mÃ¬nh tÃ¬m hiá»ƒu bÃ i viáº¿t ngÃ y hÃ´m nay nhÃ©.</p>\n<h2>1. SÆ¡ lÆ°á»£c vá» useContext.</h2>\n<p>CÃ¹ng vá»›i sá»± phÃ¡t triá»ƒn, hoÃ n thiá»‡n tá»«ng ngÃ y cá»§a React thÃ¬ <strong>React context</strong> API, vÃ  <strong>useContext</strong> Ä‘ang dáº§n trá»Ÿ nÃªn phá»• biáº¿n vÃ  ráº¥t Ä‘Æ°á»£c Æ°a chuá»™ng trong cÃ¡c dá»± Ã¡n cÃ³ scope nhá». Náº¿u toÃ n bá»™ dá»± Ã¡n chá»‰ cÃ³ má»™t vÃ i ngá»¯ cáº£nh data cáº§n truyá»n tá»« componentA sang componentB.</p>\n<p>TrÆ°á»ng há»£p A vÃ  B cÃ¡ch xa nhau, vÃ  báº¡n khÃ´ng muá»‘n pass props tá»« component A lÃªn component cha, rá»“i tá»« cha xuá»‘ng con, chÃ¡u, cháº¯t, ... cuá»‘i cÃ¹ng má»›i tá»›i Ä‘Æ°á»£c B (nghÄ© tá»›i mÃ¬nh cÅ©ng tháº¥y má»‡t ^^).</p>\n<p>VÃ­ dá»¥ nhÆ° cÃ³ má»™t thanh search chung á»Ÿ trÃªn header, hay side menu, ... vÃ  báº¡n muá»‘n á»Ÿ cÃ¡c component con cÅ©ng cÃ³ thá»ƒ thá»±c hiá»‡n thao tÃ¡c search,... thÃ¬ React context lÃ  má»™t sá»± lá»±a chá»n tuyá»‡t vá»i.</p>\n<p>Chi tiáº¿t vá» viá»‡c sá»­ dá»¥ng React context Api, useContext, cÃ¡c báº¡n cÃ³ thá»ƒ tham kháº£o á»Ÿ cÃ¡c bÃ i viáº¿t khÃ¡ hay: <a href=\"https://vntalking.com/su-dung-context-trong-react-theo-cach-don-gian-nhat.html\" rel=\"noopener noreferrer\" target=\"_blank\">Sá»­ dá»¥ng Context trong React theo cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t</a> - TÃ¡c giáº£: <strong>SÆ¡n DÆ°Æ¡ng</strong></p>\n<h2>2. Cáº©n tháº­n khi dÃ¹ng React context</h2>\n<p>NhÆ° tá»« Ä‘áº§u bÃ i viáº¿t mÃ¬nh cÃ³ nÃ³i Ä‘áº¿n viá»‡c React context ráº¥t dá»… gÃ¢y ra re-render náº¿u sá»­ dá»¥ng khÃ´ng khÃ©o lÃ©o.</p>\n<p>Dáº¡o gáº§n Ä‘Ã¢y náº¿u theo dÃµi \"ká»¹ sÆ° máº·t tiá»n\", cÃ¡c báº¡n cháº¯c háº³n Ä‘Ã£ Ä‘á»ƒ Ã½ mÃ¬nh cá»© nhai nháº£i viá»‡c re-render ^^.</p>\n<p>ThÆ°á»ng thÃ¬ re-render náº¿u khÃ´ng gÃ¢y áº£nh hÆ°á»Ÿng má»™t cÃ¡ch trá»±c quan Ä‘áº¿n project thÃ¬ báº¡n khÃ´ng cáº§n pháº£i lo láº¯ng, nhÆ°ng náº¿u cÃ³ cÃ¡c tÃ¡c vá»¥ tÃ­nh toÃ¡n vÃ  animation thÃ¬ chÃºng ta pháº£i háº¿t sá»©c cáº©n tháº­n.</p>\n<p>XÃ©t vÃ­ dá»¥ sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> useContext<span class=\"token punctuation\">,</span> useState<span class=\"token punctuation\">,</span> createContext <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> React<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> AppContext <span class=\"token operator\">=</span> <span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">AppProvider</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// biáº¿n state count nÃ y Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi component con</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>count<span class=\"token punctuation\">,</span> setCount<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// message nÃ y lÃ  cá»‘ Ä‘á»‹nh, khÃ´ng thay Ä‘á»•i</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">,</span> setMessage<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span>\n    <span class=\"token string\">'Message nÃ y mÃ  bá»‹ re-render lÃ  sáº½ Ä‘á»•i mÃ u'</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> value <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    count<span class=\"token punctuation\">,</span>\n    setCount<span class=\"token punctuation\">,</span>\n    message<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AppContext.Provider</span></span> <span class=\"token attr-name\">value</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>value<span class=\"token punctuation\">}</span></span> <span class=\"token spread\"><span class=\"token punctuation\">{</span><span class=\"token punctuation\">...</span><span class=\"token attr-value\">props</span><span class=\"token punctuation\">}</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Message</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> message <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>AppContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// má»—i láº§n bá»‹ re-render, Ä‘oáº¡n text message sáº½ cÃ³ mÃ u khÃ¡c nhau</span>\n  <span class=\"token comment\">// giÃºp chÃºng ta dá»… hÃ¬nh dung</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getColor</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    color<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">rgb(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">Count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> count<span class=\"token punctuation\">,</span> setCount <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>AppContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Current count from context: </span><span class=\"token punctuation\">{</span>count<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h3</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">onClick</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setCount</span><span class=\"token punctuation\">(</span>count <span class=\"token operator\">+</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Increment</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">AppProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Re-renders! ğŸ˜©</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Count</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">AppProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\nReactDOM<span class=\"token punctuation\">.</span><span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">App</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token punctuation\">,</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>á» Ä‘Ã¢y mÃ¬nh Ä‘Ã£ táº¡o má»™t context tÃªn lÃ  <span class='inline-code'>AppConText</span> bao gá»“m giÃ¡ trá»‹ biáº¿n Ä‘áº¿m, hÃ m set biáº¿n Ä‘áº¿m, vÃ  ná»™i dung cá»§a message.</p>\n<p>Báº±ng cÃ¡ch lÃ m nhÆ° trÃªn, Ä‘á»©ng á»Ÿ component con <span class='inline-code'>Count</span>, ta Ä‘Ã£ cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c giÃ¡ trá»‹ biáº¿n count, trá»±c tiáº¿p set biáº¿n count, á»Ÿ component <span class='inline-code'>Message</span> ta cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c ná»™i dung <strong>message</strong> truyá»n tá»« component cha xuá»‘ng <strong>mÃ  khÃ´ng cáº§n pass cÃ¡c props tá»« component cha xuá»‘ng con</strong>.</p>\n<p>NÃ³i cÃ¡ch khÃ¡c, giá» Ä‘Ã¢y, nhá» context, dÃ¹ cho component con Ä‘á»©ng á»Ÿ báº¥t cá»© Ä‘Ã¢u, miá»…n lÃ  náº±m trong pháº¡m vi cá»§a <strong>Provider</strong>, thÃ¬ chÃºng cÃ³ thá»ƒ access Ä‘Æ°á»£c cÃ¡c biáº¿n kia.</p>\n<p><strong>NHÆ¯NG</strong></p>\n<p>Cháº¡y báº£n live-demo bÃªn dÆ°á»›i (báº¥m tab Result, báº¥m Run pen), báº¡n sáº½ tháº¥y má»™t váº¥n Ä‘á» ráº¥t lá»›n, Ä‘Ã³ lÃ  <strong>re-render</strong></p>\n<p><strong>Má»—i láº§n báº¥m nÃºt tÄƒng biáº¿n Ä‘áº¿m, cÃ¡c component <span class='inline-code'>Message</span> bá»‹ re-render (Ä‘á»“ng nghÄ©a vá»›i bá»‹ Ä‘á»•i mÃ u, vÃ¬ má»—i láº§n re-render, hÃ m <span class='inline-code'>getColor</span> sáº½ Ä‘Æ°á»£c cháº¡y)</strong></p>\n<p><a href=\"https://codepen.io/b-i-kim/pen/LYNmQVe\"><div><iframe \n        height='600' \n        scrolling='no' \n        src='//codepen.io/b-i-kim/embed/preview/LYNmQVe/?height=600&theme-id=dark&default-tab=html,result' \n        frameborder='no' \n        allowtransparency='true' \n        allowfullscreen='true' \n        style='width: 100%;'></iframe></div></a></p>\n<h2>3. NguyÃªn nhÃ¢n</h2>\n<p>Trong tháº¿ giá»›i React context, <strong>táº¥t cáº£ component mÃ  consume (hay useContext, subscribe, sá»­ dá»¥ng, láº¯ng nghe,... báº¡n dÃ¹ng tá»« nÃ o cÅ©ng Ä‘Æ°á»£c) má»™t context A, thÃ¬ toÃ n bá»™ component con Ä‘Ã³ sáº½ re-render báº¥t ká»ƒ khi nÃ o context A kia thay Ä‘á»•i, dÃ¹ cho context Ä‘Ã³ khÃ´ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ render trong component con.</strong></p>\n<p>XÃ©t láº¡i vÃ­ dá»¥ message phÃ­a trÃªn, <span class='inline-code'>AppContext</span> chá»©a 3 giÃ¡ trá»‹ lÃ : biáº¿n state <span class='inline-code'>count</span>, hÃ m set giÃ¡ trá»‹ <span class='inline-code'>setCount</span>, vÃ  cuá»‘i cÃ¹ng lÃ  biáº¿n state <span class='inline-code'>message</span></p>\n<p>Má»—i khi báº¥m nÃºt tÄƒng biáº¿n Ä‘áº¿m, biáº¿n <span class='inline-code'>count</span> thay Ä‘á»•i -> AppContext thay Ä‘á»•i -> component <strong>Message</strong> re-render, máº·c dÃ¹ nÃ³ khÃ´ng há» cÃ³ nhu cáº§u, vÃ  cÅ©ng khÃ´ng liÃªn quan gÃ¬ Ä‘áº¿n viá»‡c tÄƒng giáº£m biáº¿n Ä‘áº¿m.</p>\n<p>Ok, chÃºng ta Ä‘Ã£ biáº¿t Ä‘Æ°á»£c nguyÃªn nhÃ¢n, váº­y Ä‘Ã¢u lÃ  giáº£i phÃ¡p Ä‘á»ƒ trÃ¡nh re-render khi sá»­ dá»¥ng React context?</p>\n<h2>4. CÃ¡c cÃ¡ch kháº¯c phá»¥c</h2>\n<p>CÃ¡c <strong>solution</strong> liá»‡t kÃª dÆ°á»›i Ä‘Ã¢y chÃ­nh lÃ  recommend tá»« tÃ¡c giáº£ trong Ä‘á»™i ngÅ© phÃ¡t triá»ƒn React context, anh áº¥y Ä‘Ã£ comment trong stack overflow, cÃ¡c báº¡n cÃ³ thá»ƒ <a href=\"https://github.com/facebook/react/issues/15156\" rel=\"noopener noreferrer\" target=\"_blank\">xem</a> ná»™i dung comment gá»‘c náº¿u muá»‘n.</p>\n<p><span class=\"solution-label\">TÃ¡ch context ra thÃ nh nhiá»u context khÃ¡c nhau</span></p>\n<p>CÃ¡ch Ä‘Æ°á»£c Æ°a dÃ¹ng nháº¥t lÃ  <strong>tÃ¡ch nhá» context, context nÃ o liÃªn quan Ä‘áº¿n nhau, re-render chung vá»›i nhau thÃ¬ Ä‘i chung, cÃ²n khÃ´ng thÃ¬ tÃ¡ch riÃªng</strong></p>\n<p>Thay vÃ¬ chá»‰ cÃ³ má»™t <span class='inline-code'>AppContext</span>, chÃºng ta tÃ¡ch ra lÃ m 2 context riÃªng biá»‡t lÃ  <span class='inline-code'>CounterContext</span> vÃ  <span class='inline-code'>MessageContext</span></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">function</span> <span class=\"token function\">App</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">CounterProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Count</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">CounterProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">MesageProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span> <span class=\"token punctuation\">/></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span><span class=\"token class-name\">MessageProvider</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n  );\n}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>NhÆ° váº­y, Message component Ä‘Ã£ khÃ´ng cÃ²n bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi viá»‡c tÄƒng biáº¿n Ä‘áº¿m.</p>\n<p><span class=\"solution-label\">DÃ¹ng React.memo vÃ  chÃ¨n má»™t component trung gian vÃ o giá»¯a</span></p>\n<p>Náº¿u báº¡n Ä‘ang maintain code vÃ  khÃ´ng thá»ƒ tÃ¡ch rá»i state vÃ  context nhÆ° cÃ¡ch trÃªn, thÃ¬ hÃ£y thá»­ lÃ m nhÆ° sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> Message <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">memo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getColor</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    color<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">rgb(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n    </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">componentWrapper</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>AppContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Message</span></span> <span class=\"token attr-name\">message</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>message<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;\n}</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Báº±ng cÃ¡ch sá»­ dá»¥ng React.memo vÃ  táº¡o má»™t component trung gian, thÃ¬ dÃ¹ cho componentWrapper bá»‹ re-render (bá»Ÿi viá»‡c AppContext change) thÃ¬ <strong>Message</strong> cá»§a chÃºng ta váº«n khÃ´ng bá»‹ re-render (vÃ¬ React.memo nháº­n tháº¥y prop <strong>message</strong>) nÃ³ nháº­n vÃ o khÃ´ng Ä‘á»•i. Thanks memo!</p>\n<p>Má»i tÃ¡c vá»¥ render phá»©c táº¡p Ä‘á»u náº±m á»Ÿ component <span class='inline-code'>Message</span>, nÃªn viá»‡c áº£nh hÆ°á»Ÿng performance tá»« viá»‡c rerender á»Ÿ component trung gian <span class='inline-code'>componentWrapper</span> khÃ´ng cÃ²n quan trá»ng.</p>\n<p><span class=\"solution-label\">useMemo</span></p>\n<p>CÃ¡ch cuá»‘i cÃ¹ng, vÃ¬ má»™t lÃ½ do nÃ o Ä‘Ã³ báº¡n váº«n muá»‘n má»i thá»© chá»‰ náº±m trong má»™t component, thÃ¬ hÃ£y dung <span class=\"inline-code\">useMemo</span>, wrap pháº§n giÃ¡ trá»‹ tráº£ vá» (return) bÃªn trong component Ä‘Ã³, vá»›i list cÃ¡c <strong>dependencies</strong> há»£p lÃ½.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-jsx line-numbers\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Message</span> <span class=\"token operator\">=</span> <span class=\"token parameter\">props</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> message <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">useContext</span><span class=\"token punctuation\">(</span>AppContext<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token function\">useMemo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">getColor</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> Math<span class=\"token punctuation\">.</span><span class=\"token function\">floor</span><span class=\"token punctuation\">(</span>Math<span class=\"token punctuation\">.</span><span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n      color<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">rgb(</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">,</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span><span class=\"token function\">getColor</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">)</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n        </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h4</span> <span class=\"token attr-name\">style</span><span class=\"token script language-javascript\"><span class=\"token script-punctuation punctuation\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">{</span>props<span class=\"token punctuation\">.</span>message<span class=\"token punctuation\">}</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h4</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">\n      </span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>message<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p>Vá»›i cÃ¡ch lÃ m nÃ y, component Message cá»§a chÃºng ta váº«n <strong>cháº¡y láº¡i</strong> khi <span class='inline-code'>AppContext</span> counter thay Ä‘á»•i, nhÆ°ng React sáº½ khÃ´ng render láº¡i cÃ¡c DOM node cá»§a compoennt vÃ¬ dependency <strong>message</strong> truyá»n vÃ o <strong>useMemo</strong> lÃ  giá»‘ng nhau.</p>\n<h2>5. Káº¿t luáº­n</h2>\n<p>Hy vá»ng qua bÃ i viáº¿t nÃ y, cÃ¡c báº¡n Ä‘Ã£ biáº¿t Ä‘áº¿n váº¥n Ä‘á» re-render tá»“n táº¡i vá»›i React context vÃ  cÃ¡ch xá»­ lÃ½ hiá»‡u quáº£.</p>\n<p>CÃ¹ng comment phÃ­a dÆ°á»›i náº¿u báº¡n cÃ²n biáº¿t cÃ¡ch nÃ o khÃ¡c hiá»‡u quáº£ ná»¯a nha.</p>\n<p>Tháº¥y hay thÃ¬ cho mÃ¬nh má»™t like nhÃ©, háº¹n gáº·p cÃ¡c báº¡n trong cÃ¡c bÃ i viáº¿t tiáº¿p theo.</p>\n<p>Máº¿n chÃ o cÃ¡c báº¡n!</p>\n<h2>6. Nguá»“n vÃ  bÃ i viáº¿t hay liÃªn quan</h2>\n<p><a href=\"https://github.com/facebook/react/issues/15156\">React context issue</a></p>\n<p><a href=\"https://blog.axlight.com/posts/4-options-to-prevent-extra-rerenders-with-react-context/#:~:text=If%20the%20size%20of%20your,This%20is%20by%20design.\">4 options to prevent extra rerenders with React context</a> - TÃ¡c giáº£: Daishi Kato</p>\n<p><a href=\"https://vntalking.com/su-dung-context-trong-react-theo-cach-don-gian-nhat.html\" rel=\"noopener noreferrer\" target=\"_blank\">Sá»­ dá»¥ng Context trong React theo cÃ¡ch Ä‘Æ¡n giáº£n nháº¥t</a> - TÃ¡c giáº£: SÆ¡n DÆ°Æ¡ng</p>"}